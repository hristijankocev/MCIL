<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>MCIL - Edit person</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/add-new-workplace.css}">
    <script src="/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
    <script th:src="@{/js/app.js}" defer></script>
    <script th:src="@{/js/popup-workplaces.js}"></script>
</head>
<body>
<section id="section-header" class="no-select pb-5">
    <div th:replace="fragments/header :: header"></div>
</section>

<div id="section-edit-person" class="pt-5">
    <div class="text-light">
        <div class="pb-5" style="padding: 0 1% 0 1%;">
            <p class="text-center text-danger" th:if="${error} != null" th:text="${error}"></p>
            <p class="text-center text-danger" th:if="${editError} != null" th:text="${editError}"></p>
            <div th:if="${person} != null">
                <div class="row justify-content-around" style="border-radius: 24px;">
                    <div class="col-md-4 col-sm-12 pt-3" th:id="edit-page-basic-info">
                        <div class="text-center">
                            <img th:src="${person.generateBase64Image()} ? 'data:image/png;base64,' + ${person.generateBase64Image()} : '/images/sample_pfp.jpg'"
                                 alt="pfp" th:id="pfp">
                        </div>
                        <h3 class="text-center py-4 fw-lighter"
                            th:text="${person.getFirstName()} + ' ' + ${person.getLastName()}">
                        </h3>
                        <div class="row pt-3 pb-3">
                            <div class="col-12">
                                <label for="profile-picture" class="btn btn-outline-light w-100">Choose picture</label>
                            </div>
                            <div class="col-12 pt-2">
                                <label for="pfp-submit" class="btn btn-outline-light w-100">Apply picture</label>
                            </div>
                            <div class="d-none">
                                <input type="submit" id="pfp-submit" form="form-pfp">
                            </div>
                            <div class="d-none">
                                <input type="file" id="profile-picture" name="file" accept="image/*"
                                       form="form-pfp">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8 col-sm-12 pt-5">
                        <div style="padding: 0 5% 0 5%">
                            <form th:action="@{'/person/edit/{id}' (id=${person.getId()})}" th:method="post"
                                  enctype="multipart/form-data" id="whole-info-form">
                                <div class="row">
                                    <div class="col-md-5 col-sm-12">
                                        <div class="col-12">
                                            <label for="first-name">First name</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                            <input type="text" id="first-name" name="firstName"
                                                   class="form-control-input-custom form-control"
                                                   th:value="${person.getFirstName()}" required>
                                        </div>
                                    </div>
                                    <div class="col-md-5 offset-md-2 col-sm-12">
                                        <div class="col-12">
                                            <label for="last-name">Last name</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                            <input type="text" id="last-name" name="lastName"
                                                   class=" form-control-input-custom form-control"
                                                   th:value="${person.getLastName()}" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pt-md-3 pt-sm-2">
                                    <div class="col-md-5 col-sm-12">
                                        <div class="col-12">
                                            <label for="facebook-about">Facebook about</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                        <textarea type="text" id="facebook-about" name="facebookAbout"
                                                  class=" form-control-input-custom form-control"
                                                  th:text="${person.getFacebookAbout()}"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-5 offset-md-2">
                                        <div class="co-12">
                                            <label for="linkedin-data">Linkedin data</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                        <textarea type="text" id="linkedin-data" name="linkedinData"
                                                  class="form-control-input-custom form-control"
                                                  th:text="${person.getLinkedInData()}"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pt-md-3 pt-sm-2">
                                    <div class="col-md-12 col-sm-12">
                                        <div class="col-12">
                                            <label for="workplaces">Workplaces</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                        <textarea type="text" id="workplaces" name="worksAt"
                                                  class=" form-control-input-custom form-control"
                                                  placeholder="separate items with semi-colons"></textarea>
                                        </div>
                                        <div class="col-12 pt-1">
                                            <div class="row m-0">
                                                <div th:each="workplace, iterStat : ${person.getWorksAtLinks()}"
                                                     th:classappend="${iterStat.index} > 0 ? 'mx-md-1 mx-sm-0' : ''"
                                                     class="btn btn-dark my-1 col-sm-12 col-md-auto">
                                                    <a th:text="${workplace.getName()}"
                                                       class="dropdown-toggle link-light text-decoration-none"
                                                       th:id="'workplace-dropdown-menu-button-' + ${iterStat.index}"
                                                       data-bs-toggle="dropdown" aria-expanded="false">
                                                    </a>
                                                    <ul class="dropdown-menu dropdown-menu-dark"
                                                        th:attr="aria-labelledby='workplace-dropdown-menu-button-' + ${iterStat.index}"
                                                        style="min-width: auto !important;">
                                                        <li>
                                                            <button class="dropdown-item text-center"
                                                                    type="submit"
                                                                    th:form="'form-del-workplace-' + ${person.getId()} + '-' + ${workplace.getName()}">
                                                                <i class="fa-solid fa-trash-can w-100 text-danger"></i>
                                                            </button>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--<div class="col-md-12 offset-md-2">-->
                                    <!--    <div class="col-12 pb-2">-->
                                    <!--        <label for="workplaces">Workplaces</label>-->
                                    <!--    </div>-->
                                    <!--    <div class="col-12"-->
                                    <!--         th:replace="fragments/add-new-workplace :: add-new-workplace-frag">-->
                                    <!--    </div>-->
                                    <!--</div>-->
                                </div>

                                <div class="row pt-md-3 pt-sm-2">
                                    <div class="col-md-12 col-sm-12">
                                        <div class="col-12">
                                            <label for="valid-links">Valid links</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                        <textarea type="text" id="valid-links" name="validLinks"
                                                  class=" form-control-input-custom form-control"
                                                  placeholder="separate items with semi-colons"></textarea>
                                        </div>
                                        <div class="col-12 pt-1">
                                            <div class="row m-0">
                                                <div th:each="validLink, iterStat : ${person.getValidLinks()}"
                                                     th:classappend="${iterStat.index} > 0 ? 'mx-md-1 mx-sm-0' : ''"
                                                     class="btn btn-dark my-1 col-sm-12 col-md-auto">
                                                    <a th:text="${validLink.getId()}"
                                                       class="dropdown-toggle link-light text-decoration-none"
                                                       th:id="'validlink-dropdown-menu-button-' + ${iterStat.index}"
                                                       data-bs-toggle="dropdown" aria-expanded="false">
                                                    </a>
                                                    <ul class="dropdown-menu dropdown-menu-dark"
                                                        th:attr="aria-labelledby='validlink-dropdown-menu-button-' + ${iterStat.index}"
                                                        style="min-width: auto !important;">
                                                        <li>
                                                            <button class="dropdown-item text-center"
                                                                    type="submit"
                                                                    th:form="'form-del-link-' + ${person.getId()} + '-' + ${validLink.getId()}">
                                                                <i class="fa-solid fa-trash-can w-100 text-danger"></i>
                                                            </button>
                                                        </li>
                                                        <li class="pt-2">
                                                            <button class="dropdown-item text-center"
                                                                    type="submit"
                                                                    title="move to crawled links"
                                                                    th:form="'form-move-link-' + ${validLink.getId()}">
                                                                <i class="fa-solid fa-angles-down w-100 text-info"></i>
                                                            </button>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row pt-md-3 pt-sm-2">
                                    <div class="col-md-12 col-sm-12">
                                        <div class="col-12">
                                            <label for="crawled-links">Crawled links</label>
                                        </div>
                                        <div class="col-12 pt-2">
                                        <textarea type="text" id="crawled-links" name="crawledLinks"
                                                  class="form-control-input-custom form-control"
                                                  placeholder="separate items with semi-colons"></textarea>
                                        </div>
                                        <div class="col-12 pt-1">
                                            <div class="row m-0">
                                                <div th:each="crawledLink, iterStat : ${person.getCrawledLinks()}"
                                                     th:classappend="${iterStat.index} > 0 ? 'mx-md-1 mx-sm-0' : ''"
                                                     class="btn btn-dark my-1 col-sm-12 col-md-auto">
                                                    <a th:text="${crawledLink.getId()}"
                                                       class="dropdown-toggle link-light text-decoration-none"
                                                       th:id="'crawledlink-dropdown-menu-button-' + ${iterStat.index}"
                                                       data-bs-toggle="dropdown" aria-expanded="false">
                                                    </a>
                                                    <ul class="dropdown-menu dropdown-menu-dark"
                                                        th:attr="aria-labelledby='crawledlink-dropdown-menu-button-' + ${iterStat.index}"
                                                        style="min-width: auto !important;">
                                                        <li>
                                                            <button class="dropdown-item text-center"
                                                                    type="submit"
                                                                    th:form="'form-del-link-' + ${person.getId()} + '-' + ${crawledLink.getId()}">
                                                                <i class="fa-solid fa-trash-can w-100 text-danger"></i>
                                                            </button>
                                                        </li>
                                                        <li class="pt-2">
                                                            <button class="dropdown-item text-center"
                                                                    type="submit"
                                                                    title="move to valid links"
                                                                    th:form="'form-move-link-' + ${crawledLink.getId()}">
                                                                <i class="fa-solid fa-angles-up w-100 text-info"></i>
                                                            </button>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row pt-2">
                                    <div class="col-12 text-center">
                                        <input type="submit" id="submit" name="submit" value="Update info"
                                               class="btn btn-outline-light w-100" form="whole-info-form">
                                    </div>
                                </div>
                            </form>
                            <!-- Delete forms -->
                            <div th:each="workplace : ${person.getWorksAtLinks()}">
                                <form th:action="@{'/person/{pid}/workplace/delete/{wid}' (pid = ${person.getId()}, wid = ${workplace.getName()})}"
                                      th:method="delete"
                                      th:id="'form-del-workplace-' + ${person.getId()} + '-' + ${workplace.getName()}">
                                </form>
                            </div>
                            <div th:each="validLink : ${person.getValidLinks()}">
                                <form th:action="@{'/person/{pid}/link/delete' (pid = ${person.getId()})}"
                                      th:method="delete"
                                      th:id="'form-del-link-' + ${person.getId()} + '-' + ${validLink.getId()}">
                                    <input type="hidden" th:value="${validLink.getId()}" name="linkId">
                                </form>
                            </div>
                            <div th:each="crawledLink : ${person.getCrawledLinks()}">
                                <form th:action="@{'/person/{pid}/link/delete' (pid = ${person.getId()})}"
                                      th:method="delete"
                                      th:id="'form-del-link-' + ${person.getId()} + '-' + ${crawledLink.getId()}">
                                    <input type="hidden" th:value="${crawledLink.getId()}" name="linkId">
                                </form>
                            </div>
                            <!-- Move forms -->
                            <div th:each="crawledLink : ${person.getCrawledLinks()}">
                                <form th:action="@{'/person/link/move'}"
                                      th:method="post"
                                      th:id="'form-move-link-' + ${crawledLink.getId()}">
                                    <input type="hidden" th:value="${crawledLink.getId()}" name="linkId">
                                </form>
                            </div>
                            <div th:each="validLink : ${person.getValidLinks()}">
                                <form th:action="@{'/person/link/move'}"
                                      th:method="post"
                                      th:id="'form-move-link-' + ${validLink.getId()}">
                                    <input type="hidden" th:value="${validLink.getId()}" name="linkId">
                                </form>
                            </div>
                            <form th:action="@{'/person/edit/{pid}/pfp' (pid = ${person.getId()})}"
                                  th:method="post" id="form-pfp"
                                  enctype="multipart/form-data">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>